package dto

import "time"

// VulnerabilityDTO represents a vulnerability response
type VulnerabilityDTO struct {
	ID               int64      `json:"id"`
	ResourceID       string     `json:"resource_id"`
	Provider         string     `json:"provider"`
	ResourceType     string     `json:"resource_type"`
	CVEID            string     `json:"cve_id,omitempty"`
	VulnerabilityID  string     `json:"vulnerability_id,omitempty"`
	Title            string     `json:"title"`
	Description      string     `json:"description,omitempty"`
	Severity         string     `json:"severity"`
	CVSSScore        *float64   `json:"cvss_score,omitempty"`
	CVSSVector       string     `json:"cvss_vector,omitempty"`
	PackageName      string     `json:"package_name,omitempty"`
	PackageVersion   string     `json:"package_version,omitempty"`
	FixedVersion     string     `json:"fixed_version,omitempty"`
	PackageType      string     `json:"package_type,omitempty"`
	ScannerType      string     `json:"scanner_type"`
	Status           string     `json:"status"`
	Remediation      string     `json:"remediation,omitempty"`
	PublishedDate    *time.Time `json:"published_date,omitempty"`
	LastModifiedDate *time.Time `json:"last_modified_date,omitempty"`
	DetectedAt       time.Time  `json:"detected_at"`
	ResolvedAt       *time.Time `json:"resolved_at,omitempty"`
}

// VulnerabilityScanDTO represents a vulnerability scan response
type VulnerabilityScanDTO struct {
	ID                   int64      `json:"id"`
	ResourceID           string     `json:"resource_id,omitempty"`
	ScanType             string     `json:"scan_type"`
	Status               string     `json:"status"`
	ScannerVersion       string     `json:"scanner_version,omitempty"`
	TotalVulnerabilities int        `json:"total_vulnerabilities"`
	CriticalCount        int        `json:"critical_count"`
	HighCount            int        `json:"high_count"`
	MediumCount          int        `json:"medium_count"`
	LowCount             int        `json:"low_count"`
	ScanDuration         *int       `json:"scan_duration,omitempty"`
	ErrorMessage         string     `json:"error_message,omitempty"`
	StartedAt            *time.Time `json:"started_at,omitempty"`
	CompletedAt          *time.Time `json:"completed_at,omitempty"`
	CreatedAt            time.Time  `json:"created_at"`
}

// TriggerScanRequest represents a request to trigger a vulnerability scan
type TriggerScanRequest struct {
	ScanType   string `json:"scan_type" validate:"required,oneof=trivy nvd aws-inspector gcp-scc azure-sc"`
	ResourceID string `json:"resource_id,omitempty"`
	Target     string `json:"target,omitempty"` // Image name, file path, etc.
	Provider   string `json:"provider,omitempty"`
}

// UpdateVulnerabilityStatusRequest represents a request to update vulnerability status
type UpdateVulnerabilityStatusRequest struct {
	Status string `json:"status" validate:"required,oneof=open patched ignored false_positive accepted"`
}

// VulnerabilitySummaryDTO represents vulnerability summary statistics
type VulnerabilitySummaryDTO struct {
	BySeverity SeveritySummaryDTO `json:"by_severity"`
	ByStatus   StatusSummaryDTO   `json:"by_status"`
}

// SeveritySummaryDTO represents vulnerability counts by severity
type SeveritySummaryDTO struct {
	Critical int `json:"critical"`
	High     int `json:"high"`
	Medium   int `json:"medium"`
	Low      int `json:"low"`
	Info     int `json:"info"`
	Total    int `json:"total"`
}

// StatusSummaryDTO represents vulnerability counts by status
type StatusSummaryDTO struct {
	Open          int `json:"open"`
	Patched       int `json:"patched"`
	Ignored       int `json:"ignored"`
	FalsePositive int `json:"false_positive"`
	Accepted      int `json:"accepted"`
	Total         int `json:"total"`
}
