package dto

import "time"

// VulnerabilityDTO represents a vulnerability response
type VulnerabilityDTO struct {
	ID               int64      `json:"id"`
	ResourceID       string     `json:"resourceId"`
	Provider         string     `json:"provider"`
	ResourceType     string     `json:"resourceType"`
	CVEID            string     `json:"cveId,omitempty"`
	VulnerabilityID  string     `json:"vulnerabilityId,omitempty"`
	Title            string     `json:"title"`
	Description      string     `json:"description,omitempty"`
	Severity         string     `json:"severity"`
	CVSSScore        *float64   `json:"cvssScore,omitempty"`
	CVSSVector       string     `json:"cvssVector,omitempty"`
	PackageName      string     `json:"packageName,omitempty"`
	PackageVersion   string     `json:"packageVersion,omitempty"`
	FixedVersion     string     `json:"fixedVersion,omitempty"`
	PackageType      string     `json:"packageType,omitempty"`
	ScannerType      string     `json:"scannerType"`
	Status           string     `json:"status"`
	Remediation      string     `json:"remediation,omitempty"`
	PublishedDate    *time.Time `json:"publishedDate,omitempty"`
	LastModifiedDate *time.Time `json:"lastModifiedDate,omitempty"`
	DetectedAt       time.Time  `json:"detectedAt"`
	ResolvedAt       *time.Time `json:"resolvedAt,omitempty"`
}

// VulnerabilityScanDTO represents a vulnerability scan response
type VulnerabilityScanDTO struct {
	ID                   int64      `json:"id"`
	ResourceID           string     `json:"resourceId,omitempty"`
	ScanType             string     `json:"scanType"`
	Status               string     `json:"status"`
	ScannerVersion       string     `json:"scannerVersion,omitempty"`
	TotalVulnerabilities int        `json:"totalVulnerabilities"`
	CriticalCount        int        `json:"criticalCount"`
	HighCount            int        `json:"highCount"`
	MediumCount          int        `json:"mediumCount"`
	LowCount             int        `json:"lowCount"`
	ScanDuration         *int       `json:"scanDuration,omitempty"`
	ErrorMessage         string     `json:"errorMessage,omitempty"`
	StartedAt            *time.Time `json:"startedAt,omitempty"`
	CompletedAt          *time.Time `json:"completedAt,omitempty"`
	CreatedAt            time.Time  `json:"createdAt"`
}

// TriggerScanRequest represents a request to trigger a vulnerability scan
type TriggerScanRequest struct {
	ScanType   string `json:"scanType" validate:"required,oneof=trivy nvd aws-inspector gcp-scc azure-sc"`
	ResourceID string `json:"resourceId,omitempty"`
	Target     string `json:"target,omitempty"`
	Provider   string `json:"provider,omitempty"`
}

// UpdateVulnerabilityStatusRequest represents a request to update vulnerability status
type UpdateVulnerabilityStatusRequest struct {
	Status string `json:"status" validate:"required,oneof=open patched ignored false_positive accepted"`
}

// VulnerabilitySummaryDTO represents vulnerability summary statistics
type VulnerabilitySummaryDTO struct {
	BySeverity SeveritySummaryDTO `json:"bySeverity"`
	ByStatus   StatusSummaryDTO   `json:"byStatus"`
}

// SeveritySummaryDTO represents vulnerability counts by severity
type SeveritySummaryDTO struct {
	Critical int `json:"critical"`
	High     int `json:"high"`
	Medium   int `json:"medium"`
	Low      int `json:"low"`
	Info     int `json:"info"`
	Total    int `json:"total"`
}

// StatusSummaryDTO represents vulnerability counts by status
type StatusSummaryDTO struct {
	Open          int `json:"open"`
	Patched       int `json:"patched"`
	Ignored       int `json:"ignored"`
	FalsePositive int `json:"falsePositive"`
	Accepted      int `json:"accepted"`
	Total         int `json:"total"`
}
